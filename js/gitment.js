/**
 * Minified by jsDelivr using UglifyJS v3.0.24.
 * Original file: /npm/gitment@0.0.3/dist/gitment.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function extendRenderer(t,e){t[e]=function(n){var s=(0,_utils.getTargetContainer)(n),i=t.theme[e]||t.defaultTheme[e];return(0,_mobx.autorun)(function(){var e=i(t.state,t);s.firstChild?s.replaceChild(e,s.firstChild):s.appendChild(e)}),s}}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var s="e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in" s&&(s.writable="!0),Object.defineProperty(t,s.key,s)}}return" function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),_mobx="require("mobx"),_constants=require("./constants"),_utils=require("./utils"),_default=require("./theme/default"),_default2=_interopRequireDefault(_default),scope="public_repo",Gitment=function(){function" t(){var e="this,n=arguments.length">0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),this.defaultTheme=_default2.default,this.useTheme(_default2.default),Object.assign(this,{id:window.location.href,title:window.document.title,link:window.location.href,desc:"",labels:[],theme:_default2.default,oauth:{},perPage:20,maxCommentHeight:250},n),this.useTheme(this.theme);var s={};try{var i=localStorage.getItem(_constants.LS_USER_KEY);this.accessToken&&i&&Object.assign(s,JSON.parse(i),{fromCache:!0})}catch(t){localStorage.removeItem(_constants.LS_USER_KEY)}this.state=(0,_mobx.observable)({user:s,error:null,meta:{},comments:void 0,reactions:[],commentReactions:{},currentPage:1});var r=_utils.Query.parse();if(r.code){var o=this.oauth,a=o.client_id,u=o.client_secret,c=r.code;delete r.code;var l=_utils.Query.stringify(r),h=""+window.location.origin+window.location.pathname+l+window.location.hash;history.replaceState({},"",h),Object.assign(this,{id:h,link:h},n),this.state.user.isLoggingIn=!0,_utils.http.post("https://gh-oauth.imsun.net",{code:c,client_id:a,client_secret:u},"").then(function(t){e.accessToken=t.access_token,e.update()}).catch(function(t){e.state.user.isLoggingIn=!1,alert(t)})}else this.update()}return _createClass(t,[{key:"accessToken",get:function(){return localStorage.getItem(_constants.LS_ACCESS_TOKEN_KEY)},set:function(t){localStorage.setItem(_constants.LS_ACCESS_TOKEN_KEY,t)}},{key:"loginLink",get:function(){var t=this.oauth.redirect_uri||window.location.href,e=Object.assign({scope:scope,redirect_uri:t},this.oauth);return"https://github.com/login/oauth/authorize"+_utils.Query.stringify(e)}}]),_createClass(t,[{key:"init",value:function(){var t=this;return this.createIssue().then(function(){return t.loadComments()}).then(function(e){return t.state.error=null,e})}},{key:"useTheme",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.theme=e,Object.keys(this.theme).forEach(function(e){return extendRenderer(t,e)})}},{key:"update",value:function(){var t=this;return Promise.all([this.loadMeta(),this.loadUserInfo()]).then(function(){return Promise.all([t.loadComments().then(function(){return t.loadCommentReactions()}),t.loadReactions()])}).catch(function(e){return t.state.error=e})}},{key:"markdown",value:function(t){return _utils.http.post("/markdown",{text:t,mode:"gfm"})}},{key:"createIssue",value:function(){var t=this,e=this.id,n=this.owner,s=this.repo,i=this.title,r=this.link,o=this.desc,a=this.labels;return _utils.http.post("/repos/"+n+"/"+s+"/issues",{title:i,labels:a.concat(["gitment",e]),body:r+"\n\n"+o}).then(function(e){return t.state.meta=e,e})}},{key:"getIssue",value:function(){return this.state.meta.id?Promise.resolve(this.state.meta):this.loadMeta()}},{key:"post",value:function(t){var e=this;return this.getIssue().then(function(e){return _utils.http.post(e.comments_url,{body:t},"")}).then(function(t){e.state.meta.comments++;var n=Math.ceil(e.state.meta.comments/e.perPage);return e.state.currentPage===n&&e.state.comments.push(t),t})}},{key:"loadMeta",value:function(){var t=this,e=this.id,n=this.owner,s=this.repo;return _utils.http.get("/repos/"+n+"/"+s+"/issues",{creator:n,labels:e}).then(function(e){return e.length?(t.state.meta=e[0],e[0]):Promise.reject(_constants.NOT_INITIALIZED_ERROR)})}},{key:"loadComments",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.currentPage;return this.getIssue().then(function(n){return _utils.http.get(n.comments_url,{page:e,per_page:t.perPage},"")}).then(function(e){return t.state.comments=e,e})}},{key:"loadUserInfo",value:function(){var t=this;return this.accessToken?_utils.http.get("/user").then(function(e){return t.state.user=e,localStorage.setItem(_constants.LS_USER_KEY,JSON.stringify(e)),e}):(this.logout(),Promise.resolve({}))}},{key:"loadReactions",value:function(){var t=this;return this.accessToken?this.getIssue().then(function(t){return t.reactions.total_count?_utils.http.get(t.reactions.url,{},""):[]}).then(function(e){return t.state.reactions=e,e}):(this.state.reactions=[],Promise.resolve([]))}},{key:"loadCommentReactions",value:function(){var t=this;if(!this.accessToken)return this.state.commentReactions={},Promise.resolve([]);var e=this.state.comments,n={};return Promise.all(e.map(function(e){if(!e.reactions.total_count)return[];var n=t.owner,s=t.repo;return _utils.http.get("/repos/"+n+"/"+s+"/issues/comments/"+e.id+"/reactions",{})})).then(function(s){return e.forEach(function(t,e){n[t.id]=s[e]}),t.state.commentReactions=n,n})}},{key:"login",value:function(){window.location.href=this.loginLink}},{key:"logout",value:function(){localStorage.removeItem(_constants.LS_ACCESS_TOKEN_KEY),localStorage.removeItem(_constants.LS_USER_KEY),this.state.user={}}},{key:"goto",value:function(t){return this.state.currentPage=t,this.state.comments=void 0,this.loadComments(t)}},{key:"like",value:function(){var t=this;if(!this.accessToken)return alert("Login to Like"),Promise.reject();var e=this.owner,n=this.repo;return _utils.http.post("/repos/"+e+"/"+n+"/issues/"+this.state.meta.number+"/reactions",{content:"heart"}).then(function(e){t.state.reactions.push(e),t.state.meta.reactions.heart++})}},{key:"unlike",value:function(){var t=this;if(!this.accessToken)return Promise.reject();var e=this.state,n=e.user,s=e.reactions,i=s.findIndex(function(t){return t.user.login===n.login});return _utils.http.delete("/reactions/"+s[i].id).then(function(){s.splice(i,1),t.state.meta.reactions.heart--})}},{key:"likeAComment",value:function(t){var e=this;if(!this.accessToken)return alert("Login to Like"),Promise.reject();var n=this.owner,s=this.repo,i=this.state.comments.find(function(e){return e.id===t});return _utils.http.post("/repos/"+n+"/"+s+"/issues/comments/"+t+"/reactions",{content:"heart"}).then(function(n){e.state.commentReactions[t].push(n),i.reactions.heart++})}},{key:"unlikeAComment",value:function(t){if(!this.accessToken)return Promise.reject();var e=this.state.commentReactions[t],n=this.state.comments.find(function(e){return e.id===t}),s=this.state.user,i=e.findIndex(function(t){return t.user.login===s.login});return _utils.http.delete("/reactions/"+e[i].id).then(function(){e.splice(i,1),n.reactions.heart--})}}]),t}();module.exports=Gitment;
//# sourceMappingURL=/sm/0ee347af3bfca15f5af7bda5a9f6e613a2f59977c65fb832f23bce6c979ccf6a.map
</e.length;n++){var>